def format_sample(example):
    screen = example.get("input", "")
    full = example.get("full_summary", "")

    if not screen.strip() or not full.strip():
        return {"text": None}  # None으로 리턴하면 map에서 제거할 수 있음

    messages = [
        {"role": "user", "content": f"다음 화면에 대한 요약을 생성하세요:\n{screen}"},
        {"role": "assistant", "content": full}
    ]
    return {"text": tokenizer.apply_chat_template(messages, tokenize=False)}

def is_valid(example):
    return isinstance(example["text"], str) and len(example["text"].strip()) > 0

tokenized_train = tokenized_train.filter(is_valid)
tokenized_eval = tokenized_eval.filter(is_valid)
