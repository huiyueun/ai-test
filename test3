
screens = [
    "{\n  \"hero:top\": \"btn:\\\"광고|더 보기\\\"\",\n  \"list:mid\": [\n    \"\\\"TVING | 티빙\\\"\",\n    \"[\\\"환상적인 여정\\\"]: btn:\\\"노 리사이클\\\",btn:\\\"브로드캐스트\\\",btn:\\\"하라키리\\\",btn:\\\"안녕하세요\\\"\"\n  ],\n  \"tabs:mid\": [\n    \"\\\"추천\\\",\\\"라이브\\\",\\\"앱스\\\"\"\n  ],\n  \"apps:btm\": \"\\\"SmartThings\\\",\\\"삼성 TV Plus\\\",\\\"Netflix\\\",\\\"Prime Video\\\",\\\"YouTube\\\",\\\"TVING | 티빙\\\",\\\"왓챠 | Watcha\\\",\\\"wavve\\\",\\\"Bixby\\\",\\\"Internet\\\",\\\"home_i_icon_app_edit.svg\\\"\",\n  \"list:btm\": [\n    \"\\\"TVING | 티빙\\\"\"\n  ],\n  \"tb:left\": [\n    \"\\\"home_i_icon_mode_search.svg\\\",\\\"lifestyle_home_i_mode_art.svg\\\",\\\"home_i_icon_mode_lifeplus_normal.svg\\\",\\\"home_i_icon_mode_game_normal.svg\\\",\\\"home_i_icon_mode_home_selected.svg\\\",\\\"home_i_icon_system_settings.svg\\\",\\\"home_i_icon_system_privacy_24.svg\\\"\"\n  ]\n}",
    "{\n  \"list:top\": [\n    \"\\\"극세 필터 청소가 필요합니다. 필터를 청소하여 안정적인 성능을 유지해 보세요.\\\"\",\n    \"btn:\\\"자세히 보기\\\",btn:\\\"닫기\\\"\",\n    \"\\\"i_img_pagination_nf.json\\\",\\\"i_img_pagination_nf.json\\\",\\\"i_img_pagination_nf.json\\\"\",\n    \"\\\"대시보드 | 마이 홈\\\"\",\n    \"\\\"cloudy?platform=summary\\\",\\\"73 °F\\\",\\\"1?platform=summary\\\",\\\"좋음\\\"\"\n  ],\n  \"list:mid\": [\n    \"btn:\\\"내 폰 울리기\\\"\",\n    \"btn:\\\"오프라인|기기 2개\\\",btn:\\\"Home Care|알림 2개\\\",btn:\\\"default?platform=summary|Energy|15.27 kWh\\\"\",\n    \"\\\"즐겨찾기\\\"\",\n    \"btn:\\\"거실|공기청정기|자동풍\\\"\"\n  ],\n  \"list:btm\": [\n    \"btn:\\\"체험존|체험존에서 SmartThings 사용 방법을 확인해 보세요.|Addition\\\",btn:\\\"SmartThings 허브(매터 지원)|매터 표준을 지원하는 SmartThings 허브로 폭넓은 IoT 경험을 제공합니다.\\\"\",\n    \"btn:\\\"맵뷰|TV의 대화면에서 집안의 기기와 유용한 정보를 한번에 확인해 보세요\\\",btn:\\\"빅스비 음성 제어|언제든지 빅스비를 통해 집안 상태를 확인하고 기기를 제어할 수 있습니다.\\\"\"\n  ],\n  \"tb:left\": [\n    \"\\\"st_main_menulogo_close.svg\\\",\\\"st_main_menuicon_home_sel.svg\\\",\\\"st_main_menuicon_devices_n.svg\\\",\\\"st_main_menuicon_life_n.svg\\\",\\\"st_main_menuicon_routine_n.svg\\\",\\\"st_main_menuicon_adddevice_n.svg\\\",\\\"[homemenu]resize_profile_skjcwbfpdc.jpg\\\",\\\"st_main_menuicon_settings_n.svg\\\"\"\n  ]\n}",
    "{\n  \"list:top\": [\n    \"btn:\\\"환영합니다.|바로 오늘! 아트 스토어를 체험해보세요.\\\"\"\n  ],\n  \"list:mid\": [\n    \"[\\\"내 아트 스토어\\\"]: \\\"나의 사진\\\",\\\"즐겨찾기\\\",\\\"멤버십\\\"\",\n    \"\\\"최근 감상\\\"\"\n  ],\n  \"list:btm\": [\n    \"btn:\\\"1521382429sam-s10002099_20250224052915.jpg\\\"\",\n    \"\\\"TextBox\\\"\",\n    \"\\\"TextBox\\\"\"\n  ],\n  \"tb:left\": [\n    \"\\\"home_i_icon_mode_search.svg\\\",\\\"home_i_icon_mode_art_selected.svg\\\",\\\"home_i_icon_mode_lifeplus_normal.svg\\\",\\\"home_i_icon_mode_game_normal.svg\\\",\\\"home_i_icon_mode_home_normal.svg\\\",\\\"home_i_icon_system_settings.svg\\\",\\\"home_i_icon_system_privacy_24.svg\\\"\"\n  ]\n}",
]





import json
import random
import zipfile
from pathlib import Path
import copy
import openai
import time
import os

import llm_utils

# Sample data pools for English and Korean UI elements
hero_titles = ["Stranger Things", "Breaking Bad", "The Crown", "Top Gun: Maverick", "Live News Stream"]
hero_titles_ko = ["더 글로리", "오징어 게임", "기생충", "이상한 변호사 우영우", "라이브 뉴스 스트림"]

buttons = [["Play", "More Info"], ["Watch", "Details"], ["Install"], ["Preview", "Add to List"]]

tabs_pool = [
    ["Live", "Apps", "For You"],
    ["Home", "TV Shows", "Movies", "My List"],
    ["All", "Gaming", "Music", "News"],
    ["Top", "New", "Games", "Education"],
    ["home_i_icon_mode_search.png", "lifestyle_home_i_mode_art.svg", "home_i_icon_mode_lifeplus_normal.png", "home_i_icon_mode_game_selected.png", "home_i_icon_system_settings.svg"]
]
tabs_pool_ko = [
    ["라이브", "앱", "취향저격"],
    ["홈", "TV 프로그램", "영화", "내 목록"],
    ["전체", "게임", "음악", "뉴스"]
]

sections_pool = ["Continue Watching", "Recommended", "Trending Now", "Popular Apps", "Top Games"]
sections_pool_ko = ["이어보기", "추천 콘텐츠", "인기 콘텐츠", "내가 찜한 콘텐츠", "요즘 뜨는 앱"]

toolbar_sets = [
    ["home", "photos", "settings"],
    ["search", "home", "genres", "settings"],
    ["home", "shorts", "subscriptions", "library"],
    ["search", "categories", "my apps"]
]
toolbar_sets_ko = [["홈", "사진", "설정"], ["검색", "홈", "카테고리", "설정"]]

apps_list = ["Netflix", "YouTube", "Disney+", "Spotify", "Hulu", "Zoom", "Twitch", "Prime Video"]
apps_list_ko = ["넷플릭스", "유튜브", "디즈니+", "멜론", "웨이브", "쿠팡플레이", "TVING | 티빙", "왓챠"]

regions = ["top", "mid", "btm"]

def generate_screen_json(use_korean: bool):
    use_toolbar = random.random() < 0.8
    use_hero = random.random() < 0.9
    use_apps = random.random() < 0.3
    use_grid = random.random() < 0.1

    if use_korean:
        lang = "ko"
        hero_pool = hero_titles_ko
        tabs_pool_local = tabs_pool_ko
        section_pool_local = sections_pool_ko
        toolbar_pool = toolbar_sets_ko
        app_pool = apps_list_ko
    else:
        lang = "en"
        hero_pool = hero_titles
        tabs_pool_local = tabs_pool
        section_pool_local = sections_pool
        toolbar_pool = toolbar_sets
        app_pool = apps_list

    screen_type = random.choice(["home", "detail", "store", "video", "gaming", "grid"])
    #layout = {"res": "1920x1080", "lang": lang, "screen_type": screen_type}
    #layout = {"screen_type": screen_type}
    layout = {}

    if use_toolbar:
        use_left = use_grid = random.random() < 0.7
        if use_left:
            layout["tb:left"] = random.choice(toolbar_pool)
        else:
            layout["tb:right"] = random.choice(toolbar_pool)

    if use_hero and screen_type in ["home", "store", "video", "gaming"]:
        hero = random.choice(hero_pool)
        btns = random.choice(buttons)
        layout["hero:top"] = f"{hero} | btn: {', '.join(btns)}"

    if screen_type in ["home", "store", "video", "gaming"]:
        tabs = random.choice(tabs_pool_local)
        tabs = copy.copy(tabs)
        layout[f"tabs:{random.choice(regions)}"] = tabs

    if use_grid and screen_type in ["store", "grid"]:
        layout["grid:main*"] = {
            "title": "Top Picks" if lang == "en" else "추천 앱",
            "items": random.sample(app_pool, 6)
        }

    for _ in range(random.randint(1, 3)):
        list_key = f"list:{random.choice(regions)}"
        layout[list_key] = []
        for _ in range(random.randint(1, 3)):
            use_title = random.random() < 0.4
            title = random.choice(section_pool_local)
            items = random.sample(hero_pool + hero_titles + app_pool, random.randint(1, 5))
            if use_title:
                layout[list_key].append(f"[{title}]: {', '.join(items)}")
            else:
                layout[list_key].append(f"{', '.join(items)}")

    if use_apps:
        apps_key = f"apps:{random.choice(regions)}"
        items = random.sample(app_pool, random.randint(1, 5))
        layout[apps_key] = f"{', '.join(items)}"

    return layout

def extract_layouts_from_input_file(input_file_path):
    with open(input_file_path, "r") as file:
        return json.load(file)

def generate_screen_layout(layouts, index, use_korean):
    if index < len(layouts):
        return layouts[index]
    else:
        return generate_screen_json(use_korean)

shared_limiter = llm_utils.RateLimiter(max_calls=20, per_seconds=61)
def generate_dataset(n=20, output_file="synthetic_tv_data_kr.jsonl"):
    layouts = extract_layouts_from_input_file("sample_data/input.json")
    with open(output_file, "a") as f:
        for i in range(n):
            formatted = json.dumps(
                (layouts, i, True), ensure_ascii=False, indent=2)
            print(formatted)
            summary = llm_utils.llm_request_with_rate_limit(
                llm_utils.generate_summary_llm,
                formatted,
                True,
                rate_limiter=shared_limiter)
            
            print(f"\n summary {i+1} / {n} : \n{summary}\n")
            record = {
                "input": formatted,
                "output": summary
            }
            f.write(json.dumps(record, ensure_ascii=False) + "\n")

if __name__ == "__main__":
    generate_dataset(n=500)
